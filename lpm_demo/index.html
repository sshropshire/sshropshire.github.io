<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOFORT Bank Demo</title>
    <style>
        
    </style>
  </head>
  <body>
    <button id="ideal-button">iDEAL</button>
    <button id="sofort-button">SOFORT</button>

    <script src="https://js.braintreegateway.com/web/3.85.3/js/client.min.js"></script>
    <script src="https://js.braintreegateway.com/web/3.85.3/js/local-payment.min.js"></script>
    <script>

        async function fetchClientToken() {
            
        }

        function merchantAccountId() {
            return "EUR_local";
        }

        async function createLocalPaymentInstance() {
            const authorization = await fetchClientToken();
            const client = await braintree.client.create({ authorization });
            const merchantAccountId = getMerchantAccountId();
            return braintree.localPayment.create({ client, merchantAccountId });
        }

        async function startPayment() {
            const localPaymentInstance = await createLocalPaymentInstance();
            return localPaymentInstance.startPayment({
                paymentType: 'sofort',
                amount: '10.76',
                fallback: {
                    url: 'https://sshropshire.github.io/local_payment_callback',
                    buttonText: 'Complete Payment'
                },
                currencyCode: 'EUR',
                givenName: 'Jane',
                surname: 'Doe',
                address: {
                    countryCode: 'DE'
                },
                onPaymentStart: (data, start) => {
                    console.log('ON PAYMENT START');
                    console.log(data);
                    start();
                },
            });
        }

        async function clickListener(e) {
            e.preventDefault();

            try {
                const payload = await startPayment();
                console.log('PAYMENT START COMPLETE');
                console.log(payload);
            } catch (e) {
                console.log(e);
            }
        }

        const idealButton = document.getElementById('ideal-button');
        idealButton.addEventListener('click', clickListener);

        const sofortButton = document.getElementById('sofort-button');
        sofortButton.addEventListener('click', clickListener);

    </script>
  </body>
</html>
